<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Userdata</title>
<link rel="stylesheet" href="../../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="../../../index.html" title="Chapter&#160;1.&#160;Lua Primer 0.0">
<link rel="up" href="../core.html" title="Core">
<link rel="prev" href="adapt.html" title="adapt">
<link rel="next" href="lua_ref.html" title="lua_ref">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav">
<a accesskey="p" href="adapt.html"><img src="../../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../core.html"><img src="../../../images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../images/home.png" alt="Home"></a><a accesskey="n" href="lua_ref.html"><img src="../../../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="lua_primer.reference.core.userdata"></a><a class="link" href="userdata.html" title="Userdata">Userdata</a>
</h4></div></div></div>
<p>
          userdata types are recognized using a trait, <code class="computeroutput"><span class="identifier">primer</span><span class="special">::</span><span class="identifier">traits</span><span class="special">::</span><span class="identifier">userdata</span></code>.
          This trait must be specialized for any type which primer will recognize
          as userdata, and this must provide
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
              <code class="computeroutput"><span class="keyword">static</span> <span class="keyword">const</span>
              <span class="keyword">char</span> <span class="special">*</span>
              <span class="identifier">name</span></code>: A name associated to
              the userdata. The metatable will be constructed using <code class="computeroutput"><span class="identifier">luaL_newmetatable</span></code>, using this name
              as the key. This name may also be displayed in certain error messages,
              e.g. if userdata of this type was expected and not found.
            </li>
<li class="listitem">
              <code class="computeroutput"><span class="keyword">static</span> <span class="keyword">const</span>
              <span class="identifier">luaL_Reg</span> <span class="special">*</span>
              <span class="identifier">methods</span></code>: A null-terminated
              list of metamethods for this userdata. This must include a <code class="computeroutput"><span class="identifier">__persist</span></code> metamethod, or the userdata
              cannot be persisted correctly. See eris' documentation.
            </li>
<li class="listitem">
              <code class="computeroutput"><span class="keyword">static</span> <span class="keyword">const</span>
              <span class="identifier">luaL_Reg</span> <span class="special">*</span>
              <span class="identifier">other_functions</span></code>: A null-terminated
              list of other functions related to this userdata which must be listed
              in the permanent objects table. Commonly this list contains constructors
              or other functions related to the type and exposed to the user or via
              the <code class="computeroutput"><span class="identifier">__persist</span></code> metamethod.
            </li>
</ul></div>
<p>
          <code class="computeroutput"><span class="identifier">primer</span><span class="special">::</span><span class="identifier">push_udata</span></code> is a template function which
          is used to construct new userdata objects on the stack.
        </p>
<p>
          <code class="computeroutput"><span class="identifier">push_udata</span></code> expects the
          userdata type as an explicit template parameter, and forwards all arguments
          to the constructor.
        </p>
<pre class="programlisting"><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">T</span><span class="special">,</span> <span class="keyword">typename</span><span class="special">...</span> <span class="identifier">Args</span><span class="special">&gt;</span>
<span class="keyword">void</span> <span class="identifier">push_udata</span><span class="special">(</span><span class="identifier">lua_State</span> <span class="special">*</span> <span class="identifier">L</span><span class="special">,</span> <span class="identifier">Args</span> <span class="special">&amp;&amp;</span> <span class="special">...</span> <span class="identifier">args</span><span class="special">);</span>
</pre>
<p>
          While primitive types like <code class="computeroutput"><span class="identifier">number</span></code>,
          <code class="computeroutput"><span class="identifier">string</span></code>, and <code class="computeroutput"><span class="identifier">table</span></code> are generally read from the lua
          stack by value, as C++ primitives or containers, for userdata types this
          is usually much less useful.
        </p>
<p>
          Instead, userdata types are generally read from the stack <span class="bold"><strong>by
          reference</strong></span>.
        </p>
<p>
          TODO
        </p>
<h5>
<a name="lua_primer.reference.core.userdata.h0"></a>
          <span><a name="lua_primer.reference.core.userdata.adapting_userdata_methods"></a></span><a class="link" href="userdata.html#lua_primer.reference.core.userdata.adapting_userdata_methods">Adapting
          userdata methods</a>
        </h5>
<p>
          <code class="computeroutput"><span class="identifier">PRIMER_ADAPT_USERDATA</span></code> is
          an extension of <code class="computeroutput"><span class="identifier">PRIMER_ADAPT</span></code>
          which handles member functions of a userdata type.
        </p>
<p>
          Functions thus adapted expect to be called using the standard <code class="computeroutput"><span class="identifier">object</span><span class="special">:</span><span class="identifier">method</span><span class="special">(</span><span class="identifier">arg1</span><span class="special">,</span> <span class="identifier">arg2</span><span class="special">)</span></code>
          syntax in lua, meaning that the base <code class="computeroutput"><span class="identifier">object</span></code>
          is actually the first element on the stack.
        </p>
<p>
          This is convenient because sometimes its a little nicer to implement userdata
          methods as C++ methods rather than free functions. <code class="computeroutput"><span class="identifier">PRIMER_ADAPT</span></code>
          can only directly handle free functions.
        </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2016 Chris Beck<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="adapt.html"><img src="../../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../core.html"><img src="../../../images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../images/home.png" alt="Home"></a><a accesskey="n" href="lua_ref.html"><img src="../../../images/next.png" alt="Next"></a>
</div>
</body>
</html>
