project : default-build <optimization>off debug <cxxflags>"-std=c++11 -Wall -Werror -Wextra -pedantic" ;
# project : default-build <optimization>speed release <cxxflags>"-std=c++11" ;


import modules ;

NO_EXCEPTIONS = ;

if "--no-exceptions" in [ modules.peek : ARGV ] {
  NO_EXCEPTIONS = <define>PRIMER_NO_EXCEPTIONS ;
}

if "--with-lua-32bit" in [ modules.peek : ARGV ] {
  LUA_DEFINE = <define>LUA_32BITS ;
} else {
  LUA_DEFINE = ;
}

LUA_PATH = lua-5.3.1/src ;

ALL_LUA_FLAGS = <include>$(LUA_PATH)/  $(LUA_DEFINE) ;

lib lualib : [ glob $(LUA_PATH)/*.c : $(LUA_PATH)/lua.c $(LUA_PATH)/luac.c ] : <link>static $(ALL_LUA_FLAGS) : : $(ALL_LUA_FLAGS) ;
exe lua : $(LUA_PATH)/lua.c lualib : ;



PRIMER = <include>../include/ <define>PRIMER_DEBUG ;
TEST_HARNESS = <include>include/ ;

FLAGS = $(TEST_HARNESS)  $(PRIMER) $(NO_EXCEPTIONS) ;

echo "flags = " $(FLAGS) ;

exe core : core.cpp lualib : $(FLAGS) ;
exe visitable : visitable.cpp lualib : $(FLAGS) ;
exe std : std.cpp lualib : $(FLAGS) ;


# Need to get boost directory...
TEST_HARNESS = <include>include/ <include>/usr/include ;
FLAGS = $(TEST_HARNESS)  $(PRIMER) $(NO_EXCEPTIONS) ;

exe boost : boost.cpp lualib : $(FLAGS) ;


install install-bin : core visitable std boost lua : <location>stage/ ;
