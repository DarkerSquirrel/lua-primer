<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Usage and Configuration</title>
<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="../../index.html" title="Chapter&#160;1.&#160;Lua Primer 0.3">
<link rel="up" href="../overview.html" title="Overview">
<link rel="prev" href="design.html" title="Design">
<link rel="next" href="exception_safety.html" title="Exception Safety">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav">
<a accesskey="p" href="design.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../overview.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="exception_safety.html"><img src="../../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="primer.overview.usage_and_configuration"></a><a class="link" href="usage_and_configuration.html" title="Usage and Configuration">Usage and Configuration</a>
</h3></div></div></div>
<p>
        Primer is header only -- this means that to use Primer in a C++ project,
        its <code class="computeroutput"><span class="identifier">include</span></code> directory needs
        to be added to your include search path.
      </p>
<p>
        This includes the <code class="computeroutput"><span class="identifier">primer</span></code>
        subfolder, as well as two extra libraries <code class="computeroutput"><span class="identifier">visit_struct</span></code>
        and <code class="computeroutput"><span class="identifier">weak_ref</span></code>. These both
        stand alone and are potentially useful outside of Primer, but they are small
        enough to justify distributing them with Primer.
      </p>
<h5>
<a name="primer.overview.usage_and_configuration.h0"></a>
        <span><a name="primer.overview.usage_and_configuration.what_to_include"></a></span><a class="link" href="usage_and_configuration.html#primer.overview.usage_and_configuration.what_to_include">What to
        Include</a>
      </h5>
<p>
        The <span class="emphasis"><em>core</em></span> of Primer may be included with
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">primer</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<h6>
<a name="primer.overview.usage_and_configuration.h1"></a>
        <span><a name="primer.overview.usage_and_configuration.container_support"></a></span><a class="link" href="usage_and_configuration.html#primer.overview.usage_and_configuration.container_support">Container
        support</a>
      </h6>
<p>
        To enable support for individual standard and boost containers, you may include
        any of the <span class="emphasis"><em>extra</em></span> headers
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">std</span><span class="special">/</span><span class="identifier">vector</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">std</span><span class="special">/</span><span class="identifier">set</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="special">...</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">optional</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="special">...</span>
</pre>
<p>
        or include <span class="emphasis"><em>all</em></span> standard container headers or <span class="emphasis"><em>all</em></span>
        boost container headers with
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">std</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">boost</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
        To include both <code class="computeroutput"><span class="identifier">visit_struct</span></code>
        and the related support headers in primer, you may include
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">visit_struct</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<h6>
<a name="primer.overview.usage_and_configuration.h2"></a>
        <span><a name="primer.overview.usage_and_configuration.api_persistence"></a></span><a class="link" href="usage_and_configuration.html#primer.overview.usage_and_configuration.api_persistence">Api / Persistence</a>
      </h6>
<p>
        To use the features of primer that require lua-eris, which live in the <code class="computeroutput"><span class="identifier">api</span></code> namespace, you may include
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">api</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<h6>
<a name="primer.overview.usage_and_configuration.h3"></a>
        <span><a name="primer.overview.usage_and_configuration.miscellaneous"></a></span><a class="link" href="usage_and_configuration.html#primer.overview.usage_and_configuration.miscellaneous">Miscellaneous</a>
      </h6>
<p>
        You may include <span class="emphasis"><em>forward declarations of the core types</em></span>
        via
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">primer_fwd</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
        If you only want to get the <code class="computeroutput"><span class="identifier">primer</span><span class="special">::</span><span class="identifier">error</span></code>
        or <code class="computeroutput"><span class="identifier">primer</span><span class="special">::</span><span class="identifier">expected</span></code> types, without pulling in the
        rest of primer, you may include
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">error</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">expected</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
        and forward declarations of these:
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">expected_fwd</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
        Pulling those in is very lightweight, they only rely on e.g. <code class="computeroutput"><span class="special">&lt;</span><span class="keyword">new</span><span class="special">&gt;</span></code>,
        <code class="computeroutput"><span class="special">&lt;</span><span class="identifier">string</span><span class="special">&gt;</span></code> and <code class="computeroutput"><span class="special">&lt;</span><span class="identifier">utility</span><span class="special">&gt;</span></code>.
      </p>
<p>
        If you just want to get the version number of primer, you may include
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">version</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
        Finally, if you would like to include lua or eris using exactly the same
        headers that Primer does internally, you may include
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">lua</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
        or
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">eris</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
        Primer searches for its configuration defines in <code class="computeroutput"><span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">conf</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span></code>
      </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
          All other headers are considered implementation details, and may be moved
          or nonexistant in future releases, so you shouldn't include them directly.
        </p></td></tr>
</table></div>
<h5>
<a name="primer.overview.usage_and_configuration.h4"></a>
        <span><a name="primer.overview.usage_and_configuration.build_configuration"></a></span><a class="link" href="usage_and_configuration.html#primer.overview.usage_and_configuration.build_configuration">Build
        Configuration</a>
      </h5>
<p>
        Primer responds to a few configuration defines:
      </p>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                <p>
                  symbol
                </p>
              </th>
<th>
                <p>
                  effect
                </p>
              </th>
</tr></thead>
<tbody>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">PRIMER_DEBUG</span></code>
                </p>
              </td>
<td>
                <p>
                  This is used to enable internal assertions that Primer uses to
                  check its integrity. Especially, lua stack discipline assertions.
                  You can turn these on if you are having strange lua errors, they
                  may reveal stack discipline problems in usre specializations of
                  <code class="computeroutput"><span class="identifier">push</span></code> or <code class="computeroutput"><span class="identifier">read</span></code>.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">PRIMER_LUA_AS_CPP</span></code>
                </p>
              </td>
<td>
                <p>
                  This should be used if lua is being compiled as C++ rather than
                  as C in your project. It causes primer not to use <code class="computeroutput"><span class="keyword">extern</span> <span class="string">"C"</span></code>
                  when it includes lua headers.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">PRIMER_NO_STATIC_ASSERTS</span></code>
                </p>
              </td>
<td>
                <p>
                  Disables all static assertions made by Primer.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">PRIMER_NO_EXCEPTIONS</span></code>
                </p>
              </td>
<td>
                <p>
                  Disables all try / catch blocks in primer. Use this if you want
                  to compile with <code class="computeroutput"><span class="special">-</span><span class="identifier">fno</span><span class="special">-</span><span class="identifier">exceptions</span></code>.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">PRIMER_NO_MEMORY_FAILURE</span></code>
                </p>
              </td>
<td>
                <p>
                  Tells primer to use, as an optimization assumption, that lua memory
                  allocation will never fail, and, that when populating <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span></code> and standard C++ containers,
                  that <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">bad_alloc</span></code> will not be thrown
                  either. This allows a number of try/catch blocks and <code class="computeroutput"><span class="identifier">pcall</span></code> wrappers to be eliminated.
                </p>
              </td>
</tr>
</tbody>
</table></div>
<div class="caution"><table border="0" summary="Caution">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="../../images/caution.png"></td>
<th align="left">Caution</th>
</tr>
<tr><td align="left" valign="top">
<p>
          Several data structures and functions in Primer make assumptions that types
          used with them do not throw exceptions when default constructed, moved,
          etc. These assumptions are generally true for most user types and standard
          library types that they would be used with.
        </p>
<p>
          However, if you are using an old compiler with an old version of the standard
          library, crucial constructors for objects like <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span></code>
          are not marked <code class="computeroutput"><span class="keyword">noexcept</span></code> which
          means that these assertions fail. In such a scenario, you can't compile
          and can't easily work around the problem.
        </p>
<p>
          To disable the safety checks, you can define <code class="computeroutput"><span class="identifier">PRIMER_NO_STATIC_ASSERTS</span></code>.
          You should only do this if you have an old compiler and cannot upgrade,
          <span class="emphasis"><em>and the assertions are in fact true</em></span>, just not annotated
          appropriately in your standard library headers.
        </p>
<p>
          In general the failure of the conditions checked by these assertions can
          lead to undefined behavior.
        </p>
</td></tr>
</table></div>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
          If lua is compiled as C, i.e., <code class="computeroutput"><span class="identifier">PRIMER_LUA_AS_CPP</span></code>
          is not defined, then <code class="computeroutput"><span class="identifier">PRIMER_NO_MEMORY_FAILURE</span></code>
          will be defined automatically. See <a class="link" href="exception_safety.html#exception_safety_overview">Exception
          Safety section</a> for rationale.
        </p></td></tr>
</table></div>
<p>
        To enable these, you can add them in your build system, define them in your
        source files before including primer, or create a custom version of <code class="computeroutput"><span class="special">&lt;</span><span class="identifier">primer</span><span class="special">/</span><span class="identifier">conf</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span></code>.
      </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2016 Chris Beck<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="design.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../overview.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="exception_safety.html"><img src="../../images/next.png" alt="Next"></a>
</div>
</body>
</html>
